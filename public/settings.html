<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoulTalk V2 - è¨­å®š</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            color: #333;
        }
        
        /* é ‚éƒ¨å°èˆª */
        .navbar {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .navbar a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .navbar a:hover { background: rgba(255,255,255,0.1); }
        .navbar h1 { font-size: 1.3rem; flex: 1; }
        
        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        /* åˆ†é æ¨™ç±¤ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .tab:hover { border-color: #9c27b0; }
        .tab.active {
            background: linear-gradient(135deg, #e91e63, #9c27b0);
            color: #fff;
            border-color: transparent;
        }
        
        /* è¨­å®šå€å¡Š */
        .settings-section {
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }
        
        .settings-section.active { display: block; }
        
        .section-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* èªªæ˜æ¡† */
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px 20px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 25px;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .info-box.warning {
            background: #fff3e0;
            border-color: #ff9800;
        }
        
        .info-box.success {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        
        /* é¡è‰²çµ„è¨­å®š */
        .color-groups {
            margin-bottom: 30px;
        }
        
        .color-groups h4 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #666;
        }
        
        .color-group {
            background: #fafafa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .color-group-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .color-group-name {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            width: 150px;
        }
        
        /* é¡è‰²é¸æ“‡å™¨ */
        .color-pickers {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .color-picker {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .color-picker label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .color-picker input[type="color"] {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .color-picker input[type="text"] {
            width: 90px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        /* æ–¹å‘é¸æ“‡ */
        .direction-select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
            background: #fff;
        }
        
        /* é è¦½ */
        .color-preview {
            width: 100%;
            height: 60px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        /* MBTI å‹¾é¸ */
        .mbti-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .mbti-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .mbti-checkbox:hover {
            border-color: #9c27b0;
        }
        
        .mbti-checkbox.checked {
            background: linear-gradient(135deg, #e91e63, #9c27b0);
            color: #fff;
            border-color: transparent;
        }
        
        .mbti-checkbox input {
            display: none;
        }
        
        /* æŒ‰éˆ• */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #e91e63, #9c27b0);
            color: #fff;
        }
        
        .btn-primary:hover { transform: scale(1.02); }
        
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }
        
        .btn-danger {
            background: #f44336;
            color: #fff;
        }
        
        .btn-success {
            background: #4caf50;
            color: #fff;
        }
        
        .btn-add {
            background: #2196f3;
            color: #fff;
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            margin-top: 15px;
        }
        
        /* è¡¨å–®é …ç›® */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            border-color: #9c27b0;
            outline: none;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        /* é–‹é—œ */
        .switch-group {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #fafafa;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .switch {
            position: relative;
            width: 50px;
            height: 26px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #ccc;
            transition: 0.4s;
            border-radius: 26px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background: linear-gradient(135deg, #e91e63, #9c27b0);
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        /* å„²å­˜æç¤º */
        .save-toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #4caf50;
            color: #fff;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .save-toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* çµå°¾é è¦½ */
        .ending-preview {
            background: linear-gradient(135deg, #1a1a2e, #0f3460);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            aspect-ratio: 1;
            max-width: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .ending-preview .text {
            color: #fff;
            font-weight: 500;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            animation: fadeInOut 4s ease-in-out infinite;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* RWD */
        @media (max-width: 600px) {
            .container { padding: 15px; }
            .tabs { gap: 5px; }
            .tab { padding: 10px 15px; font-size: 0.9rem; }
            .color-pickers { flex-direction: column; }
            .mbti-checkboxes { grid-template-columns: repeat(4, 1fr); }
        }
    </style>
</head>
<body>
    <!-- å°èˆª -->
    <nav class="navbar">
        <h1>âš™ï¸ è¨­å®š</h1>
        <a href="/">ğŸ  é¦–é </a>
        <a href="/mv">ğŸ¬ MV</a>
        <a href="/audio">ğŸ¤ èªéŸ³</a>
        <a href="/ending" style="background: rgba(102,126,234,0.3);">âœ¨ å°ˆå±¬çµå°¾</a>
    </nav>
    
    <div class="container">
        <!-- åˆ†é æ¨™ç±¤ -->
        <div class="tabs">
            <div class="tab active" data-tab="mbti-colors">ğŸ¨ MBTI é¡è‰²</div>
            <a href="/ending" class="tab" style="text-decoration: none;">âœ¨ å°ˆå±¬çµå°¾ â†’</a>
            <div class="tab" data-tab="images">ğŸ–¼ï¸ åœ–ç‰‡åˆ†é¡</div>
            <div class="tab" data-tab="subtitle">ğŸ“ å­—å¹•è¨­å®š</div>
            <div class="tab" data-tab="notifications">ğŸ”” é€šçŸ¥è¨­å®š</div>
        </div>
        
        <!-- å°ˆå±¬çµå°¾å¿«æ·å…¥å£ -->
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; border-radius: 15px; padding: 25px; margin-bottom: 20px;">
            <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                <div>
                    <h3 style="margin-bottom: 8px;">âœ¨ å°ˆå±¬çµå°¾è¨­å®š</h3>
                    <p style="opacity: 0.9;">å½±ç‰‡æœ€å¾Œ 8 ç§’é¡¯ç¤ºå°ˆå±¬æ–‡å­—ï¼Œæ…¢æ…¢æ·¡å…¥æ·¡å‡º</p>
                </div>
                <a href="/ending" style="background: #fff; color: #667eea; padding: 12px 30px; border-radius: 10px; text-decoration: none; font-weight: bold; transition: transform 0.3s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    ğŸ‘‰ é»æˆ‘è¨­å®šï¼ˆè¶…ç°¡å–®ï¼ï¼‰
                </a>
            </div>
        </div>
        
        <!-- ========================================
             MBTI é¡è‰²è¨­å®š
        ======================================== -->
        <div class="settings-section active" id="section-mbti-colors">
            <div class="section-title">ğŸ¨ MBTI èƒŒæ™¯é¡è‰²è¨­å®š</div>
            
            <div class="info-box">
                <strong>ğŸ’¡ é€™æ˜¯ä»€éº¼ï¼Ÿ</strong><br>
                æ ¹æ“šç”¨æˆ¶çš„ã€Œæ€§åˆ¥ã€å’Œã€ŒMBTIã€è‡ªå‹•å¥—ç”¨ä¸åŒçš„èƒŒæ™¯é¡è‰²ã€‚<br><br>
                <strong>æ€éº¼ç”¨ï¼Ÿ</strong><br>
                1ï¸âƒ£ è¨­å®šé¡è‰²çµ„ï¼ˆ3 å€‹é¡è‰² + æ¼¸å±¤æ–¹å‘ï¼‰<br>
                2ï¸âƒ£ å‹¾é¸é€™çµ„é¡è‰²è¦å¥—ç”¨çµ¦å“ªäº› MBTI<br>
                3ï¸âƒ£ è¼‰å…¥è³‡æ–™æ™‚æœƒè‡ªå‹•é…å°ï¼
            </div>
            
            <!-- ç”·æ€§é¡è‰²çµ„ -->
            <div class="color-groups" id="male-groups">
                <h4>ğŸ‘¨ ç”·æ€§èƒŒæ™¯é¡è‰²</h4>
                <!-- å‹•æ…‹ç”Ÿæˆ -->
            </div>
            <button class="btn btn-add" onclick="addColorGroup('male')">â• æ–°å¢ç”·æ€§é¡è‰²çµ„</button>
            
            <hr style="margin: 30px 0; border: none; border-top: 2px dashed #e0e0e0;">
            
            <!-- å¥³æ€§é¡è‰²çµ„ -->
            <div class="color-groups" id="female-groups">
                <h4>ğŸ‘© å¥³æ€§èƒŒæ™¯é¡è‰²</h4>
                <!-- å‹•æ…‹ç”Ÿæˆ -->
            </div>
            <button class="btn btn-add" onclick="addColorGroup('female')">â• æ–°å¢å¥³æ€§é¡è‰²çµ„</button>
            
            <hr style="margin: 30px 0; border: none; border-top: 2px dashed #e0e0e0;">
            
            <!-- MBTI è¦–è¦ºåƒæ•¸ -->
            <div class="section-title" style="margin-top: 30px;">ğŸŒŸ MBTI è¦–è¦ºåƒæ•¸</div>
            
            <div class="info-box">
                <strong>ğŸ’¡ é€²éšåŠŸèƒ½</strong><br>
                æ ¹æ“š MBTI çš„å­—æ¯è‡ªå‹•èª¿æ•´è¦–è¦ºæ•ˆæœï¼Œè®“æ¯ç¨®é¡å‹éƒ½æœ‰ç¨ç‰¹çš„æ„Ÿè¦ºã€‚
            </div>
            
            <div class="switch-group">
                <label class="switch">
                    <input type="checkbox" id="visual-enabled" checked>
                    <span class="slider"></span>
                </label>
                <div>
                    <strong>å•Ÿç”¨ MBTI è¦–è¦ºèª¿æ•´</strong>
                    <div style="font-size: 0.85rem; color: #666;">æ ¹æ“š MBTI å­—æ¯è‡ªå‹•èª¿æ•´æ˜Ÿæ˜Ÿã€æµæ˜Ÿç­‰æ•ˆæœ</div>
                </div>
            </div>
            
            <div class="form-row" id="visual-params">
                <div class="form-group">
                    <label>T å‹æ˜Ÿæ˜Ÿæ•¸é‡ï¼ˆç†æ€§å‹ï¼Œè¼ƒå°‘ï¼‰</label>
                    <input type="number" id="starsT" value="40" min="10" max="100">
                </div>
                <div class="form-group">
                    <label>F å‹æ˜Ÿæ˜Ÿæ•¸é‡ï¼ˆæ„Ÿæ€§å‹ï¼Œè¼ƒå¤šï¼‰</label>
                    <input type="number" id="starsF" value="80" min="10" max="100">
                </div>
                <div class="form-group">
                    <label>P å‹æµæ˜Ÿæ•¸é‡ï¼ˆéš¨æ€§å‹ï¼Œè¼ƒå¤šï¼‰</label>
                    <input type="number" id="shootingP" value="5" min="1" max="10">
                </div>
                <div class="form-group">
                    <label>J å‹æµæ˜Ÿæ•¸é‡ï¼ˆè¨ˆåŠƒå‹ï¼Œè¼ƒå°‘ï¼‰</label>
                    <input type="number" id="shootingJ" value="2" min="1" max="10">
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="saveMBTIColors()">ğŸ’¾ å„²å­˜ MBTI é¡è‰²è¨­å®š</button>
        </div>
        
        <!-- ========================================
             å°ˆå±¬çµå°¾è¨­å®š - å·²ç§»è‡³å°ˆå±¬é é¢
        ======================================== -->
        <div class="settings-section" id="section-ending">
            <div class="section-title">âœ¨ å°ˆå±¬çµå°¾è¨­å®š</div>
            
            <div style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 4rem; margin-bottom: 20px;">âœ¨</div>
                <h3 style="margin-bottom: 15px;">å°ˆå±¬çµå°¾æœ‰äº†æ–°çš„è¨­å®šé é¢ï¼</h3>
                <p style="color: #666; margin-bottom: 25px;">
                    æˆ‘å€‘è¨­è¨ˆäº†ä¸€å€‹è¶…ç´šç°¡å–®çš„è¨­å®šä»‹é¢<br>
                    è®“ä½ è¼•é¬†è¨­å®šå½±ç‰‡æœ€å¾Œçš„å°ˆå±¬æ–‡å­—
                </p>
                <a href="/ending" style="display: inline-block; background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; padding: 15px 40px; border-radius: 12px; text-decoration: none; font-size: 1.1rem; font-weight: bold; transition: transform 0.3s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    ğŸ‘‰ å‰å¾€è¨­å®šï¼ˆè¶…ç°¡å–®ï¼ï¼‰
                </a>
            </div>
        </div>
        
        <!-- ========================================
             åœ–ç‰‡åˆ†é¡è¨­å®š
        ======================================== -->
        <div class="settings-section" id="section-images">
            <div class="section-title">ğŸ–¼ï¸ åœ–ç‰‡æ¨™é¡Œè‡ªå‹•åˆ†é¡</div>
            
            <div class="info-box">
                <strong>ğŸ’¡ é€™æ˜¯ä»€éº¼ï¼Ÿ</strong><br>
                æ ¹æ“šåœ–ç‰‡æ¨™é¡Œä¸­çš„é—œéµå­—ï¼Œè‡ªå‹•åˆ†é¡åœ–ç‰‡é¡å‹ã€‚<br>
                ä¾‹å¦‚ï¼šæ¨™é¡Œæ˜¯ã€Œå‹•ä½œåœ–1-R2ã€ï¼Œå¦‚æœ Transparent è¨­äº†ã€Œå‹•ä½œåœ–ã€ï¼Œå°±æœƒè‡ªå‹•æ­¸åˆ°å»èƒŒåœ–ã€‚
            </div>
            
            <div class="form-group">
                <label>ğŸ–¼ï¸ Fullï¼ˆå…¨å¹…åœ–ï¼‰é—œéµå­—</label>
                <input type="text" id="keywords-full" placeholder="header,å°é¢,cover,ä¸»è¦–è¦º">
                <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                    ç”¨é€—è™Ÿåˆ†éš”å¤šå€‹é—œéµå­—
                </div>
            </div>
            
            <div class="form-group">
                <label>ğŸ­ Transparentï¼ˆå»èƒŒåœ–ï¼‰é—œéµå­—</label>
                <input type="text" id="keywords-transparent" placeholder="Qç‰ˆ,å‹•ä½œåœ–,äººç‰©,ä¸»äººç‰©,å»èƒŒ">
            </div>
            
            <div class="form-group">
                <label>ğŸŒ… Backgroundï¼ˆèƒŒæ™¯åœ–ï¼‰é—œéµå­—</label>
                <input type="text" id="keywords-background" placeholder="æ¼«ç•«åœ–1,æ¼«ç•«åœ–2,æ¼«ç•«åœ–3,æ¼«ç•«åœ–">
            </div>
            
            <div class="form-group">
                <label>ğŸ“± Staticï¼ˆéœæ…‹åœ–ï¼‰é—œéµå­—</label>
                <input type="text" id="keywords-static" placeholder="éœæ…‹,static,èªéŸ³å°é¢">
            </div>
            
            <button class="btn btn-primary" onclick="saveImageKeywords()">ğŸ’¾ å„²å­˜åœ–ç‰‡åˆ†é¡è¨­å®š</button>
        </div>
        
        <!-- ========================================
             å­—å¹•è¨­å®š
        ======================================== -->
        <div class="settings-section" id="section-subtitle">
            <div class="section-title">ğŸ“ å­—å¹•è¨­å®š</div>
            
            <div class="info-box">
                <strong>ğŸ’¡ é›»è…¦/æ‰‹æ©Ÿ/å…¨è¢å¹•</strong><br>
                ä¸åŒè£ç½®æœƒè‡ªå‹•å¥—ç”¨å°æ‡‰çš„å­—é«”å¤§å°ï¼Œç¢ºä¿åœ¨ä»»ä½•è¢å¹•ä¸Šéƒ½æ¸…æ™°å¯è®€ã€‚
            </div>
            
            <h4 style="margin-bottom: 15px;">å­—å¹•å¤§å°</h4>
            <div class="form-row">
                <div class="form-group">
                    <label>ğŸ’» é›»è…¦ç‰ˆ (px)</label>
                    <input type="number" id="subtitle-fontSize" value="28" min="16" max="60">
                </div>
                <div class="form-group">
                    <label>ğŸ“± æ‰‹æ©Ÿç‰ˆ (px)</label>
                    <input type="number" id="subtitle-fontSizeMobile" value="22" min="12" max="40">
                </div>
                <div class="form-group">
                    <label>ğŸ–¥ï¸ å…¨è¢å¹• (px)</label>
                    <input type="number" id="subtitle-fontSizeFullscreen" value="36" min="20" max="80">
                </div>
            </div>
            
            <h4 style="margin: 25px 0 15px;">å­—å¹•é¡è‰²</h4>
            <div class="form-row">
                <div class="form-group">
                    <label>æœªå”±é¡è‰²</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="color" id="subtitle-unsungColor" value="#ffffff" style="width: 60px; height: 40px;">
                        <input type="text" id="subtitle-unsungColorText" value="#ffffff" style="width: 100px;">
                    </div>
                </div>
                <div class="form-group">
                    <label>å·²å”±é¡è‰²ï¼ˆMV æ¨¡å¼ï¼‰</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="color" id="subtitle-sungColor" value="#4d4d4d" style="width: 60px; height: 40px;">
                        <input type="text" id="subtitle-sungColorText" value="#4d4d4d" style="width: 100px;">
                    </div>
                </div>
                <div class="form-group">
                    <label>æé‚Šé¡è‰²</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="color" id="subtitle-borderColor" value="#ffffff" style="width: 60px; height: 40px;">
                        <input type="text" id="subtitle-borderColorText" value="#ffffff" style="width: 100px;">
                    </div>
                </div>
            </div>
            
            <h4 style="margin: 25px 0 15px;">å­—é–“è·</h4>
            <div class="form-row">
                <div class="form-group">
                    <label>MV æ¨¡å¼å­—é–“è· (em)</label>
                    <input type="number" id="subtitle-letterSpacingMV" value="0.05" min="0" max="0.5" step="0.01">
                </div>
                <div class="form-group">
                    <label>èªéŸ³æ¨¡å¼å­—é–“è· (em)</label>
                    <input type="number" id="subtitle-letterSpacingAudio" value="0.08" min="0" max="0.5" step="0.01">
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="saveSubtitle()">ğŸ’¾ å„²å­˜å­—å¹•è¨­å®š</button>
        </div>
        
        <!-- ========================================
             é€šçŸ¥è¨­å®š
        ======================================== -->
        <div class="settings-section" id="section-notifications">
            <div class="section-title">ğŸ”” é€šçŸ¥è¨­å®š</div>
            
            <div class="info-box">
                <strong>ğŸ’¡ Telegram é€šçŸ¥</strong><br>
                ä¸Šå‚³å®Œæˆæ™‚è‡ªå‹•ç™¼é€é€šçŸ¥åˆ°ä½ çš„ Telegramã€‚
            </div>
            
            <div class="switch-group">
                <label class="switch">
                    <input type="checkbox" id="telegram-enabled">
                    <span class="slider"></span>
                </label>
                <div>
                    <strong>å•Ÿç”¨ Telegram é€šçŸ¥</strong>
                </div>
            </div>
            
            <div class="form-group">
                <label>Bot Token</label>
                <input type="text" id="telegram-botToken" placeholder="å¾ @BotFather å–å¾—">
            </div>
            
            <div class="form-group">
                <label>Chat ID</label>
                <input type="text" id="telegram-chatId" placeholder="ä½ çš„ Telegram Chat ID">
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn btn-success" onclick="testTelegram()">ğŸ§ª æ¸¬è©¦é€šçŸ¥</button>
                <button class="btn btn-primary" onclick="saveNotifications()">ğŸ’¾ å„²å­˜é€šçŸ¥è¨­å®š</button>
            </div>
        </div>
    </div>
    
    <!-- å„²å­˜æç¤º -->
    <div class="save-toast" id="saveToast">âœ… è¨­å®šå·²å„²å­˜ï¼</div>
    
    <script>
        // ========================================
        // å…¨åŸŸè®Šæ•¸
        // ========================================
        let config = {};
        const ALL_MBTI = ['INTJ', 'INTP', 'ENTJ', 'ENTP', 'INFJ', 'INFP', 'ENFJ', 'ENFP', 
                         'ISTJ', 'ISFJ', 'ESTJ', 'ESFJ', 'ISTP', 'ISFP', 'ESTP', 'ESFP'];
        
        // ========================================
        // åˆå§‹åŒ–
        // ========================================
        document.addEventListener('DOMContentLoaded', async () => {
            // è¼‰å…¥è¨­å®š
            await loadConfig();
            
            // åˆ†é åˆ‡æ›
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`section-${tab.dataset.tab}`).classList.add('active');
                });
            });
            
            // é¡è‰²åŒæ­¥
            setupColorSync();
            
            // çµå°¾é è¦½æ›´æ–°
            document.getElementById('ending-template').addEventListener('input', updateEndingPreview);
            document.getElementById('ending-fontSize').addEventListener('input', updateEndingPreview);
        });
        
        // ========================================
        // è¼‰å…¥è¨­å®š
        // ========================================
        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                config = await response.json();
                console.log('âœ… è¨­å®šå·²è¼‰å…¥:', config);
                
                renderMBTIColors();
                renderEnding();
                renderImageKeywords();
                renderSubtitle();
                renderNotifications();
                
            } catch (error) {
                console.error('âŒ è¼‰å…¥è¨­å®šå¤±æ•—:', error);
                showToast('è¼‰å…¥è¨­å®šå¤±æ•—', false);
            }
        }
        
        // ========================================
        // MBTI é¡è‰²æ¸²æŸ“
        // ========================================
        function renderMBTIColors() {
            const groups = config.mbtiColorGroups || { male: [], female: [] };
            
            renderColorGroups('male', groups.male || []);
            renderColorGroups('female', groups.female || []);
            
            // è¦–è¦ºåƒæ•¸
            const visual = config.mbtiVisualParams || {};
            document.getElementById('visual-enabled').checked = visual.enabled !== false;
            document.getElementById('starsT').value = visual.starsT || 40;
            document.getElementById('starsF').value = visual.starsF || 80;
            document.getElementById('shootingP').value = visual.shootingP || 5;
            document.getElementById('shootingJ').value = visual.shootingJ || 2;
        }
        
        function renderColorGroups(gender, groups) {
            const container = document.getElementById(`${gender}-groups`);
            const title = gender === 'male' ? 'ğŸ‘¨ ç”·æ€§èƒŒæ™¯é¡è‰²' : 'ğŸ‘© å¥³æ€§èƒŒæ™¯é¡è‰²';
            
            let html = `<h4>${title}</h4>`;
            
            groups.forEach((group, index) => {
                const colors = group.colors || ['#1a1a2e', '#16213e', '#0f3460'];
                const direction = group.direction || 'to-bottom-right';
                const gradientCSS = getGradientCSS(colors, direction);
                
                html += `
                    <div class="color-group" data-gender="${gender}" data-index="${index}">
                        <div class="color-group-header">
                            <input type="text" class="color-group-name" value="${group.name || `é¡è‰²çµ„ ${index + 1}`}" 
                                   onchange="updateGroupName('${gender}', ${index}, this.value)">
                            <select class="direction-select" onchange="updateDirection('${gender}', ${index}, this.value)">
                                <option value="to-bottom" ${direction === 'to-bottom' ? 'selected' : ''}>â†“ ä¸Šåˆ°ä¸‹</option>
                                <option value="to-right" ${direction === 'to-right' ? 'selected' : ''}>â†’ å·¦åˆ°å³</option>
                                <option value="to-bottom-right" ${direction === 'to-bottom-right' ? 'selected' : ''}>â†˜ å·¦ä¸Šåˆ°å³ä¸‹</option>
                                <option value="to-bottom-left" ${direction === 'to-bottom-left' ? 'selected' : ''}>â†™ å³ä¸Šåˆ°å·¦ä¸‹</option>
                                <option value="radial" ${direction === 'radial' ? 'selected' : ''}>â— æ”¾å°„ç‹€</option>
                            </select>
                            <button class="btn btn-danger" onclick="deleteColorGroup('${gender}', ${index})">ğŸ—‘ï¸ åˆªé™¤</button>
                        </div>
                        
                        <div class="color-pickers">
                            <div class="color-picker">
                                <label>è‰²1:</label>
                                <input type="color" value="${colors[0]}" onchange="updateColor('${gender}', ${index}, 0, this.value)">
                                <input type="text" value="${colors[0]}" onchange="updateColorFromText('${gender}', ${index}, 0, this.value)">
                            </div>
                            <div class="color-picker">
                                <label>è‰²2:</label>
                                <input type="color" value="${colors[1]}" onchange="updateColor('${gender}', ${index}, 1, this.value)">
                                <input type="text" value="${colors[1]}" onchange="updateColorFromText('${gender}', ${index}, 1, this.value)">
                            </div>
                            <div class="color-picker">
                                <label>è‰²3:</label>
                                <input type="color" value="${colors[2]}" onchange="updateColor('${gender}', ${index}, 2, this.value)">
                                <input type="text" value="${colors[2]}" onchange="updateColorFromText('${gender}', ${index}, 2, this.value)">
                            </div>
                        </div>
                        
                        <div class="color-preview" style="background: ${gradientCSS};"></div>
                        
                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">å‹¾é¸è¦å¥—ç”¨æ­¤é¡è‰²çš„ MBTIï¼š</div>
                        <div class="mbti-checkboxes">
                            ${ALL_MBTI.map(mbti => {
                                const checked = (group.assignedMBTI || []).includes(mbti);
                                return `
                                    <label class="mbti-checkbox ${checked ? 'checked' : ''}" onclick="toggleMBTI('${gender}', ${index}, '${mbti}', this)">
                                        <input type="checkbox" ${checked ? 'checked' : ''}>
                                        ${mbti}
                                    </label>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function getGradientCSS(colors, direction) {
            if (direction === 'radial') {
                return `radial-gradient(circle, ${colors[0]} 0%, ${colors[1]} 50%, ${colors[2]} 100%)`;
            }
            const dirMap = {
                'to-bottom': '180deg',
                'to-right': '90deg',
                'to-bottom-right': '135deg',
                'to-bottom-left': '225deg'
            };
            return `linear-gradient(${dirMap[direction] || '135deg'}, ${colors[0]} 0%, ${colors[1]} 50%, ${colors[2]} 100%)`;
        }
        
        function addColorGroup(gender) {
            if (!config.mbtiColorGroups) config.mbtiColorGroups = { male: [], female: [] };
            if (!config.mbtiColorGroups[gender]) config.mbtiColorGroups[gender] = [];
            
            config.mbtiColorGroups[gender].push({
                id: `${gender}-${Date.now()}`,
                name: `æ–°é¡è‰²çµ„`,
                colors: ['#1a1a2e', '#16213e', '#0f3460'],
                direction: 'to-bottom-right',
                assignedMBTI: []
            });
            
            renderColorGroups(gender, config.mbtiColorGroups[gender]);
        }
        
        function deleteColorGroup(gender, index) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹é¡è‰²çµ„å—ï¼Ÿ')) {
                config.mbtiColorGroups[gender].splice(index, 1);
                renderColorGroups(gender, config.mbtiColorGroups[gender]);
            }
        }
        
        function updateGroupName(gender, index, name) {
            config.mbtiColorGroups[gender][index].name = name;
        }
        
        function updateDirection(gender, index, direction) {
            config.mbtiColorGroups[gender][index].direction = direction;
            renderColorGroups(gender, config.mbtiColorGroups[gender]);
        }
        
        function updateColor(gender, index, colorIndex, value) {
            config.mbtiColorGroups[gender][index].colors[colorIndex] = value;
            renderColorGroups(gender, config.mbtiColorGroups[gender]);
        }
        
        function updateColorFromText(gender, index, colorIndex, value) {
            if (/^#[0-9A-Fa-f]{6}$/.test(value)) {
                updateColor(gender, index, colorIndex, value);
            }
        }
        
        function toggleMBTI(gender, index, mbti, element) {
            const group = config.mbtiColorGroups[gender][index];
            if (!group.assignedMBTI) group.assignedMBTI = [];
            
            const mbtiIndex = group.assignedMBTI.indexOf(mbti);
            if (mbtiIndex > -1) {
                group.assignedMBTI.splice(mbtiIndex, 1);
                element.classList.remove('checked');
            } else {
                // å…ˆå¾å…¶ä»–çµ„ç§»é™¤
                config.mbtiColorGroups[gender].forEach((g, i) => {
                    if (i !== index && g.assignedMBTI) {
                        const idx = g.assignedMBTI.indexOf(mbti);
                        if (idx > -1) g.assignedMBTI.splice(idx, 1);
                    }
                });
                group.assignedMBTI.push(mbti);
                element.classList.add('checked');
            }
            
            // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°å…¶ä»–çµ„çš„é¡¯ç¤º
            renderColorGroups(gender, config.mbtiColorGroups[gender]);
        }
        
        async function saveMBTIColors() {
            try {
                // å„²å­˜é¡è‰²çµ„
                await fetch('/api/config/mbti-colors', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config.mbtiColorGroups)
                });
                
                // å„²å­˜è¦–è¦ºåƒæ•¸
                const visualParams = {
                    enabled: document.getElementById('visual-enabled').checked,
                    starsT: parseInt(document.getElementById('starsT').value),
                    starsF: parseInt(document.getElementById('starsF').value),
                    shootingP: parseInt(document.getElementById('shootingP').value),
                    shootingJ: parseInt(document.getElementById('shootingJ').value)
                };
                
                await fetch('/api/config/mbti-visual', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(visualParams)
                });
                
                showToast('MBTI é¡è‰²è¨­å®šå·²å„²å­˜ï¼');
            } catch (error) {
                showToast('å„²å­˜å¤±æ•—', false);
            }
        }
        
        // ========================================
        // å°ˆå±¬çµå°¾
        // ========================================
        function renderEnding() {
            const ending = config.customEnding || {};
            document.getElementById('ending-enabled').checked = ending.enabled !== false;
            document.getElementById('ending-template').value = ending.template || 'é€™æ˜¯å±¬æ–¼ {name} çš„ {mbti} å°ˆå±¬æ™‚åˆ»';
            document.getElementById('ending-fontSize').value = ending.fontSize || 28;
            document.getElementById('ending-fontSizeMobile').value = ending.fontSizeMobile || 20;
            document.getElementById('ending-duration').value = ending.duration || 8;
            document.getElementById('ending-fadeIn').value = ending.fadeInDuration || 1.5;
            document.getElementById('ending-fadeOut').value = ending.fadeOutDuration || 2;
            updateEndingPreview();
        }
        
        function updateEndingPreview() {
            const template = document.getElementById('ending-template').value;
            const fontSize = document.getElementById('ending-fontSize').value;
            const previewText = template.replace('{name}', 'å°æ˜').replace('{mbti}', 'INFP');
            
            const preview = document.getElementById('ending-preview-text');
            preview.textContent = previewText;
            preview.style.fontSize = fontSize + 'px';
        }
        
        async function saveEnding() {
            try {
                const data = {
                    enabled: document.getElementById('ending-enabled').checked,
                    template: document.getElementById('ending-template').value,
                    fontSize: parseInt(document.getElementById('ending-fontSize').value),
                    fontSizeMobile: parseInt(document.getElementById('ending-fontSizeMobile').value),
                    duration: parseInt(document.getElementById('ending-duration').value),
                    fadeInDuration: parseFloat(document.getElementById('ending-fadeIn').value),
                    fadeOutDuration: parseFloat(document.getElementById('ending-fadeOut').value)
                };
                
                await fetch('/api/config/custom-ending', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                showToast('å°ˆå±¬çµå°¾è¨­å®šå·²å„²å­˜ï¼');
            } catch (error) {
                showToast('å„²å­˜å¤±æ•—', false);
            }
        }
        
        // ========================================
        // åœ–ç‰‡åˆ†é¡
        // ========================================
        function renderImageKeywords() {
            const keywords = config.imageKeywords || {};
            document.getElementById('keywords-full').value = keywords.full || '';
            document.getElementById('keywords-transparent').value = keywords.transparent || '';
            document.getElementById('keywords-background').value = keywords.background || '';
            document.getElementById('keywords-static').value = keywords.static || '';
        }
        
        async function saveImageKeywords() {
            try {
                const data = {
                    full: document.getElementById('keywords-full').value,
                    transparent: document.getElementById('keywords-transparent').value,
                    background: document.getElementById('keywords-background').value,
                    static: document.getElementById('keywords-static').value
                };
                
                await fetch('/api/config/image-keywords', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                showToast('åœ–ç‰‡åˆ†é¡è¨­å®šå·²å„²å­˜ï¼');
            } catch (error) {
                showToast('å„²å­˜å¤±æ•—', false);
            }
        }
        
        // ========================================
        // å­—å¹•è¨­å®š
        // ========================================
        function renderSubtitle() {
            const styles = config.subtitleStyles || {};
            document.getElementById('subtitle-fontSize').value = styles.fontSize || 28;
            document.getElementById('subtitle-fontSizeMobile').value = styles.fontSizeMobile || 22;
            document.getElementById('subtitle-fontSizeFullscreen').value = styles.fontSizeFullscreen || 36;
            document.getElementById('subtitle-unsungColor').value = styles.unsungColor || '#ffffff';
            document.getElementById('subtitle-unsungColorText').value = styles.unsungColor || '#ffffff';
            document.getElementById('subtitle-sungColor').value = styles.sungColor || '#4d4d4d';
            document.getElementById('subtitle-sungColorText').value = styles.sungColor || '#4d4d4d';
            document.getElementById('subtitle-borderColor').value = styles.borderColor || '#ffffff';
            document.getElementById('subtitle-borderColorText').value = styles.borderColor || '#ffffff';
            document.getElementById('subtitle-letterSpacingMV').value = styles.letterSpacingMV || 0.05;
            document.getElementById('subtitle-letterSpacingAudio').value = styles.letterSpacingAudio || 0.08;
        }
        
        async function saveSubtitle() {
            try {
                const data = {
                    fontSize: parseInt(document.getElementById('subtitle-fontSize').value),
                    fontSizeMobile: parseInt(document.getElementById('subtitle-fontSizeMobile').value),
                    fontSizeFullscreen: parseInt(document.getElementById('subtitle-fontSizeFullscreen').value),
                    unsungColor: document.getElementById('subtitle-unsungColor').value,
                    sungColor: document.getElementById('subtitle-sungColor').value,
                    borderColor: document.getElementById('subtitle-borderColor').value,
                    letterSpacingMV: parseFloat(document.getElementById('subtitle-letterSpacingMV').value),
                    letterSpacingAudio: parseFloat(document.getElementById('subtitle-letterSpacingAudio').value)
                };
                
                await fetch('/api/config/subtitle', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                showToast('å­—å¹•è¨­å®šå·²å„²å­˜ï¼');
            } catch (error) {
                showToast('å„²å­˜å¤±æ•—', false);
            }
        }
        
        // ========================================
        // é€šçŸ¥è¨­å®š
        // ========================================
        function renderNotifications() {
            const notifications = config.notifications || {};
            const telegram = notifications.telegram || {};
            
            document.getElementById('telegram-enabled').checked = telegram.enabled || false;
            document.getElementById('telegram-botToken').value = telegram.botToken || '';
            document.getElementById('telegram-chatId').value = telegram.chatId || '';
        }
        
        async function saveNotifications() {
            try {
                const data = {
                    telegram: {
                        enabled: document.getElementById('telegram-enabled').checked,
                        botToken: document.getElementById('telegram-botToken').value,
                        chatId: document.getElementById('telegram-chatId').value
                    }
                };
                
                const response = await fetch('/api/config/notifications', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                showToast(result.message || 'é€šçŸ¥è¨­å®šå·²å„²å­˜ï¼', result.success);
            } catch (error) {
                showToast('å„²å­˜å¤±æ•—', false);
            }
        }
        
        async function testTelegram() {
            try {
                // å…ˆå„²å­˜
                await saveNotifications();
                
                const response = await fetch('/api/config/notifications/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                showToast(result.message, result.success);
            } catch (error) {
                showToast('æ¸¬è©¦å¤±æ•—: ' + error.message, false);
            }
        }
        
        // ========================================
        // å·¥å…·å‡½æ•¸
        // ========================================
        function setupColorSync() {
            // é¡è‰²é¸æ“‡å™¨å’Œæ–‡å­—è¼¸å…¥åŒæ­¥
            ['unsung', 'sung', 'border'].forEach(type => {
                const colorInput = document.getElementById(`subtitle-${type}Color`);
                const textInput = document.getElementById(`subtitle-${type}ColorText`);
                
                if (colorInput && textInput) {
                    colorInput.addEventListener('input', () => {
                        textInput.value = colorInput.value;
                    });
                    textInput.addEventListener('input', () => {
                        if (/^#[0-9A-Fa-f]{6}$/.test(textInput.value)) {
                            colorInput.value = textInput.value;
                        }
                    });
                }
            });
        }
        
        function showToast(message, success = true) {
            const toast = document.getElementById('saveToast');
            toast.textContent = success ? `âœ… ${message}` : `âŒ ${message}`;
            toast.style.background = success ? '#4caf50' : '#f44336';
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
