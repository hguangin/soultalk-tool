<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoulTalk V2 - å°ˆå±¬çµå°¾è¨­å®š</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Noto Sans TC', -apple-system, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
            color: #333;
        }
        
        /* å°èˆª */
        .navbar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .navbar h1 { font-size: 1.4rem; flex: 1; }
        .navbar a {
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            padding: 10px 18px;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }
        .navbar a:hover { background: rgba(255,255,255,0.2); }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        /* å¤§æ¨™é¡Œèªªæ˜ */
        .page-intro {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .page-intro h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }
        
        .page-intro p {
            font-size: 1.1rem;
            opacity: 0.95;
            line-height: 1.8;
        }
        
        /* æ­¥é©Ÿå¡ç‰‡ */
        .step-card {
            background: #fff;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .step-card:hover {
            border-color: #667eea;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .step-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .step-title {
            flex: 1;
        }
        
        .step-title h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            color: #333;
        }
        
        .step-title p {
            font-size: 0.95rem;
            color: #666;
        }
        
        /* é–‹é—œ - è¶…å¤§ç‰ˆ */
        .big-switch {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .big-switch:hover {
            background: #f0f2f5;
        }
        
        .big-switch.on {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 2px solid #667eea;
        }
        
        .switch-toggle {
            width: 70px;
            height: 38px;
            background: #ccc;
            border-radius: 19px;
            position: relative;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .switch-toggle::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            background: #fff;
            border-radius: 50%;
            top: 4px;
            left: 4px;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .big-switch.on .switch-toggle {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .big-switch.on .switch-toggle::after {
            left: 36px;
        }
        
        .switch-label {
            flex: 1;
        }
        
        .switch-label .title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .switch-label .desc {
            font-size: 0.9rem;
            color: #666;
        }
        
        .switch-status {
            font-size: 1.1rem;
            font-weight: bold;
            padding: 8px 20px;
            border-radius: 20px;
        }
        
        .big-switch.on .switch-status {
            background: #4caf50;
            color: #fff;
        }
        
        .big-switch:not(.on) .switch-status {
            background: #e0e0e0;
            color: #666;
        }
        
        /* æ–‡å­—ç·¨è¼¯å€ */
        .text-editor {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
        }
        
        .text-editor label {
            display: block;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .text-editor input {
            width: 100%;
            padding: 18px 20px;
            font-size: 1.2rem;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .text-editor input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
        }
        
        /* è®Šæ•¸æç¤º */
        .variable-hints {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .variable-hint {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .variable-hint:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .variable-hint code {
            background: #667eea;
            color: #fff;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.95rem;
        }
        
        .variable-hint span {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* æ»‘æ¡¿è¨­å®š */
        .slider-group {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .slider-header label {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .slider-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            padding: 8px 20px;
            border-radius: 10px;
        }
        
        .slider-container {
            position: relative;
            padding: 10px 0;
        }
        
        .slider-container input[type="range"] {
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4);
        }
        
        .slider-desc {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
        }
        
        .slider-scale {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.85rem;
            color: #999;
        }
        
        /* å³æ™‚é è¦½ */
        .live-preview {
            background: #000;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .preview-screen {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* æ˜Ÿæ˜ŸèƒŒæ™¯ */
        .preview-stars {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            overflow: hidden;
        }
        
        .preview-star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* çµå°¾æ–‡å­— */
        .ending-text {
            color: #fff;
            text-align: center;
            padding: 30px;
            z-index: 10;
            position: relative;
            text-shadow: 0 3px 15px rgba(0,0,0,0.5);
            animation: fadeInOut 4s ease-in-out infinite;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: scale(0.95); }
            20% { opacity: 1; transform: scale(1); }
            80% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.95); }
        }
        
        .preview-label {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: rgba(0,0,0,0.7);
            color: #fff;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
        }
        
        /* é è¨­æ¨¡æ¿ */
        .template-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .template-option {
            padding: 20px;
            background: #fff;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .template-option:hover {
            border-color: #667eea;
        }
        
        .template-option.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .template-option .preview {
            font-size: 0.95rem;
            color: #333;
            margin-bottom: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .template-option .desc {
            font-size: 0.85rem;
            color: #666;
        }
        
        /* å„²å­˜æŒ‰éˆ• */
        .save-section {
            background: #fff;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .save-btn {
            padding: 20px 60px;
            font-size: 1.3rem;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .save-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
        }
        
        .save-btn:active {
            transform: translateY(0);
        }
        
        /* æˆåŠŸæç¤º */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #4caf50;
            color: #fff;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            opacity: 0;
            transition: all 0.5s;
            z-index: 1000;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* å°æç¤ºæ¡† */
        .tip-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 0 12px 12px 0;
            margin: 20px 0;
        }
        
        .tip-box strong {
            color: #856404;
        }
        
        .tip-box p {
            margin-top: 10px;
            color: #856404;
            line-height: 1.6;
        }
        
        /* RWD */
        @media (max-width: 600px) {
            .container { padding: 15px; }
            .step-card { padding: 20px; }
            .page-intro { padding: 20px; }
            .page-intro h2 { font-size: 1.4rem; }
            .variable-hints { flex-direction: column; }
            .slider-value { font-size: 1.1rem; padding: 6px 15px; }
        }
    </style>
</head>
<body>
    <!-- å°èˆª -->
    <nav class="navbar">
        <h1>âœ¨ å°ˆå±¬çµå°¾è¨­å®š</h1>
        <a href="/">ğŸ  é¦–é </a>
        <a href="/settings">âš™ï¸ è¨­å®š</a>
        <a href="/mv">ğŸ¬ MV</a>
    </nav>
    
    <div class="container">
        <!-- é é¢ä»‹ç´¹ -->
        <div class="page-intro">
            <h2>ğŸŒŸ è®“æ¯å€‹äººéƒ½æœ‰å°ˆå±¬çš„çµå°¾</h2>
            <p>
                åœ¨å½±ç‰‡æœ€å¾Œ 8 ç§’ï¼Œé¡¯ç¤ºä¸€æ®µå°ˆå±¬æ–‡å­—<br>
                æ…¢æ…¢æ·¡å…¥ï¼Œåœç•™ä¸€ä¸‹ï¼Œå†æ…¢æ…¢æ·¡å‡º<br>
                ä¾‹å¦‚ï¼šã€Œé€™æ˜¯å±¬æ–¼ å°æ˜ çš„ INFP å°ˆå±¬æ™‚åˆ»ã€
            </p>
        </div>
        
        <!-- æ­¥é©Ÿ 1: é–‹é—œ -->
        <div class="step-card">
            <div class="step-header">
                <div class="step-number">1</div>
                <div class="step-title">
                    <h3>è¦ä¸è¦ç”¨é€™å€‹åŠŸèƒ½ï¼Ÿ</h3>
                    <p>å…ˆæ±ºå®šè¦ä¸è¦åœ¨å½±ç‰‡æœ€å¾Œé¡¯ç¤ºå°ˆå±¬æ–‡å­—</p>
                </div>
            </div>
            
            <div class="big-switch on" id="mainSwitch" onclick="toggleSwitch()">
                <div class="switch-toggle"></div>
                <div class="switch-label">
                    <div class="title">å°ˆå±¬çµå°¾åŠŸèƒ½</div>
                    <div class="desc">åœ¨å½±ç‰‡æœ€å¾Œé¡¯ç¤ºå°ˆå±¬æ–¼é€™å€‹äººçš„æ–‡å­—</div>
                </div>
                <div class="switch-status" id="switchStatus">å·²é–‹å•Ÿ</div>
            </div>
        </div>
        
        <!-- æ­¥é©Ÿ 2: æ–‡å­—å…§å®¹ -->
        <div class="step-card" id="step2">
            <div class="step-header">
                <div class="step-number">2</div>
                <div class="step-title">
                    <h3>è¦é¡¯ç¤ºä»€éº¼æ–‡å­—ï¼Ÿ</h3>
                    <p>é¸ä¸€å€‹æ¨¡æ¿ï¼Œæˆ–è‡ªå·±æ‰“å­—</p>
                </div>
            </div>
            
            <!-- é è¨­æ¨¡æ¿ -->
            <div style="margin-bottom: 25px;">
                <label style="font-size: 1rem; font-weight: 600; margin-bottom: 15px; display: block;">
                    ğŸ“‹ é¸ä¸€å€‹å–œæ­¡çš„æ¨¡æ¿ï¼ˆé»é¸å°±æœƒå¥—ç”¨ï¼‰ï¼š
                </label>
                <div class="template-options">
                    <div class="template-option selected" onclick="selectTemplate(this, 'é€™æ˜¯å±¬æ–¼ {name} çš„ {mbti} å°ˆå±¬æ™‚åˆ»')">
                        <div class="preview">é€™æ˜¯å±¬æ–¼ <strong>å°æ˜</strong> çš„ <strong>INFP</strong> å°ˆå±¬æ™‚åˆ»</div>
                        <div class="desc">ç¶“å…¸æ¬¾ - é¡¯ç¤ºåå­—å’Œ MBTI</div>
                    </div>
                    <div class="template-option" onclick="selectTemplate(this, 'ç»çµ¦ç¨ä¸€ç„¡äºŒçš„ {name}')">
                        <div class="preview">ç»çµ¦ç¨ä¸€ç„¡äºŒçš„ <strong>å°æ˜</strong></div>
                        <div class="desc">ç°¡ç´„æ¬¾ - åªé¡¯ç¤ºåå­—</div>
                    </div>
                    <div class="template-option" onclick="selectTemplate(this, '{name}ï¼Œ{mbti} çš„ä½ æœ€ç‰¹åˆ¥')">
                        <div class="preview"><strong>å°æ˜</strong>ï¼Œ<strong>INFP</strong> çš„ä½ æœ€ç‰¹åˆ¥</div>
                        <div class="desc">è¦ªå¯†æ¬¾ - åƒåœ¨å°ä»–èªªè©±</div>
                    </div>
                    <div class="template-option" onclick="selectTemplate(this, 'å°ˆå±¬æ–¼ {name} çš„ç™‚ç™’æ™‚å…‰')">
                        <div class="preview">å°ˆå±¬æ–¼ <strong>å°æ˜</strong> çš„ç™‚ç™’æ™‚å…‰</div>
                        <div class="desc">ç™‚ç™’æ¬¾ - æº«æš–æ²»ç™’é¢¨</div>
                    </div>
                </div>
            </div>
            
            <!-- è‡ªè¨‚æ–‡å­— -->
            <div class="text-editor">
                <label>âœï¸ æˆ–è€…è‡ªå·±æ‰“å­—ï¼ˆå¯ä»¥ç”¨ä¸‹é¢çš„è®Šæ•¸ï¼‰ï¼š</label>
                <input type="text" id="endingText" value="é€™æ˜¯å±¬æ–¼ {name} çš„ {mbti} å°ˆå±¬æ™‚åˆ»" 
                       oninput="updatePreview()" placeholder="è¼¸å…¥ä½ æƒ³é¡¯ç¤ºçš„æ–‡å­—">
                
                <div class="variable-hints">
                    <div class="variable-hint" onclick="insertVariable('{name}')">
                        <code>{name}</code>
                        <span>= é€™å€‹äººçš„åå­—</span>
                    </div>
                    <div class="variable-hint" onclick="insertVariable('{mbti}')">
                        <code>{mbti}</code>
                        <span>= é€™å€‹äººçš„ MBTI</span>
                    </div>
                </div>
            </div>
            
            <div class="tip-box">
                <strong>ğŸ’¡ å°æç¤º</strong>
                <p>
                    <code>{name}</code> æœƒè‡ªå‹•æ›æˆé‚£å€‹äººçš„åå­—<br>
                    <code>{mbti}</code> æœƒè‡ªå‹•æ›æˆé‚£å€‹äººçš„ MBTI é¡å‹<br>
                    ä¾‹å¦‚ï¼šã€Œé€™æ˜¯å±¬æ–¼ {name} çš„æ™‚åˆ»ã€â†’ã€Œé€™æ˜¯å±¬æ–¼ å°æ˜ çš„æ™‚åˆ»ã€
                </p>
            </div>
        </div>
        
        <!-- æ­¥é©Ÿ 3: å­—é«”å¤§å° -->
        <div class="step-card" id="step3">
            <div class="step-header">
                <div class="step-number">3</div>
                <div class="step-title">
                    <h3>å­—è¦å¤šå¤§ï¼Ÿ</h3>
                    <p>æ‹‰å‹•æ»‘æ¡¿èª¿æ•´å¤§å°ï¼Œå³é‚Šå¯ä»¥å³æ™‚é è¦½</p>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <!-- é›»è…¦ç‰ˆå­—é«” -->
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>ğŸ’» é›»è…¦ä¸Šçœ‹åˆ°çš„å¤§å°</label>
                            <div class="slider-value"><span id="desktopValue">28</span> px</div>
                        </div>
                        <div class="slider-container">
                            <input type="range" id="desktopSize" min="16" max="60" value="28" 
                                   oninput="updateSlider('desktop')">
                        </div>
                        <div class="slider-scale">
                            <span>å¾ˆå° 16</span>
                            <span>æ™®é€š 36</span>
                            <span>å¾ˆå¤§ 60</span>
                        </div>
                        <div class="slider-desc">ğŸ’¡ å»ºè­° 24-36 ä¹‹é–“ï¼Œå¤ªå¤§æœƒå¾ˆæ“ </div>
                    </div>
                    
                    <!-- æ‰‹æ©Ÿç‰ˆå­—é«” -->
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>ğŸ“± æ‰‹æ©Ÿä¸Šçœ‹åˆ°çš„å¤§å°</label>
                            <div class="slider-value"><span id="mobileValue">20</span> px</div>
                        </div>
                        <div class="slider-container">
                            <input type="range" id="mobileSize" min="12" max="40" value="20" 
                                   oninput="updateSlider('mobile')">
                        </div>
                        <div class="slider-scale">
                            <span>å¾ˆå° 12</span>
                            <span>æ™®é€š 24</span>
                            <span>å¾ˆå¤§ 40</span>
                        </div>
                        <div class="slider-desc">ğŸ’¡ å»ºè­° 18-28 ä¹‹é–“ï¼Œæ‰‹æ©Ÿè¢å¹•å°</div>
                    </div>
                </div>
                
                <!-- å³æ™‚é è¦½ -->
                <div class="live-preview">
                    <div class="preview-screen" id="previewScreen">
                        <div class="preview-stars" id="previewStars"></div>
                        <div class="ending-text" id="previewText">
                            é€™æ˜¯å±¬æ–¼ å°æ˜ çš„ INFP å°ˆå±¬æ™‚åˆ»
                        </div>
                        <div class="preview-label">ğŸ‘ï¸ å³æ™‚é è¦½</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ­¥é©Ÿ 4: æ™‚é–“è¨­å®š -->
        <div class="step-card" id="step4">
            <div class="step-header">
                <div class="step-number">4</div>
                <div class="step-title">
                    <h3>é¡¯ç¤ºå¤šä¹…ï¼Ÿæ·¡å…¥æ·¡å‡ºå¤šå¿«ï¼Ÿ</h3>
                    <p>æ§åˆ¶æ–‡å­—å‡ºç¾å’Œæ¶ˆå¤±çš„æ™‚é–“</p>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                <!-- é¡¯ç¤ºæ™‚é•· -->
                <div class="slider-group">
                    <div class="slider-header">
                        <label>â±ï¸ ç¸½å…±é¡¯ç¤ºå¹¾ç§’</label>
                        <div class="slider-value"><span id="durationValue">8</span> ç§’</div>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="duration" min="3" max="15" value="8" 
                               oninput="updateSlider('duration')">
                    </div>
                    <div class="slider-desc">ğŸ’¡ å»ºè­° 6-10 ç§’ï¼Œå¤ªçŸ­ä¾†ä¸åŠçœ‹</div>
                </div>
                
                <!-- æ·¡å…¥æ™‚é–“ -->
                <div class="slider-group">
                    <div class="slider-header">
                        <label>ğŸŒ… æ·¡å…¥æ™‚é–“</label>
                        <div class="slider-value"><span id="fadeInValue">1.5</span> ç§’</div>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="fadeIn" min="0.5" max="5" value="1.5" step="0.5"
                               oninput="updateSlider('fadeIn')">
                    </div>
                    <div class="slider-desc">ğŸ’¡ æ–‡å­—æ…¢æ…¢å‡ºç¾è¦å¤šä¹…</div>
                </div>
                
                <!-- æ·¡å‡ºæ™‚é–“ -->
                <div class="slider-group">
                    <div class="slider-header">
                        <label>ğŸŒ‡ æ·¡å‡ºæ™‚é–“</label>
                        <div class="slider-value"><span id="fadeOutValue">2</span> ç§’</div>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="fadeOut" min="0.5" max="5" value="2" step="0.5"
                               oninput="updateSlider('fadeOut')">
                    </div>
                    <div class="slider-desc">ğŸ’¡ æ–‡å­—æ…¢æ…¢æ¶ˆå¤±è¦å¤šä¹…</div>
                </div>
            </div>
            
            <div class="tip-box" style="margin-top: 20px;">
                <strong>ğŸ¬ æ™‚é–“è»¸èªªæ˜</strong>
                <p>
                    å‡è¨­è¨­å®šã€Œé¡¯ç¤º 8 ç§’ã€ã€Œæ·¡å…¥ 1.5 ç§’ã€ã€Œæ·¡å‡º 2 ç§’ã€ï¼š<br>
                    ğŸ“ å½±ç‰‡çµæŸå‰ 8 ç§’ â†’ æ–‡å­—é–‹å§‹æ·¡å…¥<br>
                    ğŸ“ 1.5 ç§’å¾Œ â†’ æ–‡å­—å®Œå…¨é¡¯ç¤º<br>
                    ğŸ“ å†é 4.5 ç§’ â†’ æ–‡å­—é–‹å§‹æ·¡å‡º<br>
                    ğŸ“ 2 ç§’å¾Œ â†’ æ–‡å­—å®Œå…¨æ¶ˆå¤±ï¼ˆå‰›å¥½å½±ç‰‡çµæŸï¼‰
                </p>
            </div>
        </div>
        
        <!-- å„²å­˜ -->
        <div class="save-section">
            <button class="save-btn" onclick="saveSettings()">
                ğŸ’¾ å„²å­˜è¨­å®š
            </button>
            <p style="margin-top: 15px; color: #666;">
                è¨­å®šæœƒè‡ªå‹•å¥—ç”¨åˆ°æ‰€æœ‰æ–°ç”¢ç”Ÿçš„å½±ç‰‡
            </p>
        </div>
    </div>
    
    <!-- æˆåŠŸæç¤º -->
    <div class="toast" id="toast">âœ… è¨­å®šå·²å„²å­˜æˆåŠŸï¼</div>
    
    <script>
        // ========================================
        // åˆå§‹åŒ–
        // ========================================
        document.addEventListener('DOMContentLoaded', async () => {
            // è¼‰å…¥ç¾æœ‰è¨­å®š
            await loadSettings();
            
            // ç”Ÿæˆé è¦½æ˜Ÿæ˜Ÿ
            generateStars();
            
            // æ›´æ–°é è¦½
            updatePreview();
        });
        
        // ========================================
        // è¼‰å…¥è¨­å®š
        // ========================================
        async function loadSettings() {
            try {
                const response = await fetch('/api/config/custom-ending');
                const settings = await response.json();
                
                // å¥—ç”¨è¨­å®š
                const isEnabled = settings.enabled !== false;
                document.getElementById('mainSwitch').classList.toggle('on', isEnabled);
                document.getElementById('switchStatus').textContent = isEnabled ? 'å·²é–‹å•Ÿ' : 'å·²é—œé–‰';
                toggleSteps(isEnabled);
                
                document.getElementById('endingText').value = settings.template || 'é€™æ˜¯å±¬æ–¼ {name} çš„ {mbti} å°ˆå±¬æ™‚åˆ»';
                document.getElementById('desktopSize').value = settings.fontSize || 28;
                document.getElementById('mobileSize').value = settings.fontSizeMobile || 20;
                document.getElementById('duration').value = settings.duration || 8;
                document.getElementById('fadeIn').value = settings.fadeInDuration || 1.5;
                document.getElementById('fadeOut').value = settings.fadeOutDuration || 2;
                
                // æ›´æ–°é¡¯ç¤º
                updateSlider('desktop');
                updateSlider('mobile');
                updateSlider('duration');
                updateSlider('fadeIn');
                updateSlider('fadeOut');
                updatePreview();
                
                // é¸ä¸­å°æ‡‰çš„æ¨¡æ¿
                highlightMatchingTemplate(settings.template);
                
            } catch (error) {
                console.error('è¼‰å…¥è¨­å®šå¤±æ•—:', error);
            }
        }
        
        // ========================================
        // é–‹é—œ
        // ========================================
        function toggleSwitch() {
            const sw = document.getElementById('mainSwitch');
            const isOn = !sw.classList.contains('on');
            sw.classList.toggle('on', isOn);
            document.getElementById('switchStatus').textContent = isOn ? 'å·²é–‹å•Ÿ' : 'å·²é—œé–‰';
            toggleSteps(isOn);
        }
        
        function toggleSteps(show) {
            ['step2', 'step3', 'step4'].forEach(id => {
                document.getElementById(id).style.opacity = show ? '1' : '0.5';
                document.getElementById(id).style.pointerEvents = show ? 'auto' : 'none';
            });
        }
        
        // ========================================
        // æ¨¡æ¿é¸æ“‡
        // ========================================
        function selectTemplate(element, template) {
            // ç§»é™¤å…¶ä»–é¸ä¸­
            document.querySelectorAll('.template-option').forEach(el => {
                el.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // æ›´æ–°è¼¸å…¥æ¡†
            document.getElementById('endingText').value = template;
            updatePreview();
        }
        
        function highlightMatchingTemplate(template) {
            document.querySelectorAll('.template-option').forEach(el => {
                el.classList.remove('selected');
            });
            
            const templates = [
                'é€™æ˜¯å±¬æ–¼ {name} çš„ {mbti} å°ˆå±¬æ™‚åˆ»',
                'ç»çµ¦ç¨ä¸€ç„¡äºŒçš„ {name}',
                '{name}ï¼Œ{mbti} çš„ä½ æœ€ç‰¹åˆ¥',
                'å°ˆå±¬æ–¼ {name} çš„ç™‚ç™’æ™‚å…‰'
            ];
            
            const index = templates.indexOf(template);
            if (index >= 0) {
                document.querySelectorAll('.template-option')[index]?.classList.add('selected');
            }
        }
        
        // ========================================
        // æ’å…¥è®Šæ•¸
        // ========================================
        function insertVariable(variable) {
            const input = document.getElementById('endingText');
            const start = input.selectionStart;
            const end = input.selectionEnd;
            const value = input.value;
            
            input.value = value.substring(0, start) + variable + value.substring(end);
            input.focus();
            input.setSelectionRange(start + variable.length, start + variable.length);
            
            updatePreview();
        }
        
        // ========================================
        // æ»‘æ¡¿æ›´æ–°
        // ========================================
        function updateSlider(type) {
            const map = {
                desktop: { slider: 'desktopSize', display: 'desktopValue' },
                mobile: { slider: 'mobileSize', display: 'mobileValue' },
                duration: { slider: 'duration', display: 'durationValue' },
                fadeIn: { slider: 'fadeIn', display: 'fadeInValue' },
                fadeOut: { slider: 'fadeOut', display: 'fadeOutValue' }
            };
            
            const config = map[type];
            if (config) {
                const value = document.getElementById(config.slider).value;
                document.getElementById(config.display).textContent = value;
            }
            
            updatePreview();
        }
        
        // ========================================
        // æ›´æ–°é è¦½
        // ========================================
        function updatePreview() {
            const template = document.getElementById('endingText').value;
            const fontSize = document.getElementById('desktopSize').value;
            
            // æ›¿æ›è®Šæ•¸ç‚ºç¤ºç¯„å€¼
            const previewText = template
                .replace('{name}', 'å°æ˜')
                .replace('{mbti}', 'INFP');
            
            const preview = document.getElementById('previewText');
            preview.textContent = previewText;
            preview.style.fontSize = fontSize + 'px';
        }
        
        // ========================================
        // ç”Ÿæˆæ˜Ÿæ˜Ÿ
        // ========================================
        function generateStars() {
            const container = document.getElementById('previewStars');
            container.innerHTML = '';
            
            for (let i = 0; i < 30; i++) {
                const star = document.createElement('div');
                star.className = 'preview-star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = (Math.random() * 2 + 1) + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                container.appendChild(star);
            }
        }
        
        // ========================================
        // å„²å­˜è¨­å®š
        // ========================================
        async function saveSettings() {
            const settings = {
                enabled: document.getElementById('mainSwitch').classList.contains('on'),
                template: document.getElementById('endingText').value,
                fontSize: parseInt(document.getElementById('desktopSize').value),
                fontSizeMobile: parseInt(document.getElementById('mobileSize').value),
                duration: parseInt(document.getElementById('duration').value),
                fadeInDuration: parseFloat(document.getElementById('fadeIn').value),
                fadeOutDuration: parseFloat(document.getElementById('fadeOut').value)
            };
            
            try {
                const response = await fetch('/api/config/custom-ending', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('âœ… è¨­å®šå·²å„²å­˜æˆåŠŸï¼');
                } else {
                    showToast('âŒ å„²å­˜å¤±æ•—ï¼Œè«‹é‡è©¦', false);
                }
                
            } catch (error) {
                showToast('âŒ å„²å­˜å¤±æ•—: ' + error.message, false);
            }
        }
        
        // ========================================
        // é¡¯ç¤ºæç¤º
        // ========================================
        function showToast(message, success = true) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = success ? '#4caf50' : '#f44336';
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
